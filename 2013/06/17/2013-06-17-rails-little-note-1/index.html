<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Rails little note 1</title><link rel="shortcut icon" href="/images/avatar.png"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css"><script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script></head><body><nav class="main-nav"><a href="/">Home</a><a href="/archives">Archives</a></nav><div class="profile"><section id="wrapper"><header id="header"><a href="/about"><img class="2x" id="avatar" src="/images/avatar.png"></a><h1>無名之島</h1><h2></h2></header></section></div><section class="post" id="wrapper"><article><header><h1>Rails little note 1</h1><h2 class="headline">Jun 17, 2013 4:26·645 words
·2 minutes read<span class="tags"></span></h2></header><section id="post-body"><p>##rails cli##<br>Active Record 支持的数据类型</p>
<ul>
<li>:binary</li>
<li>:boolean</li>
<li>:date</li>
<li>:datetime</li>
<li>:decimal</li>
<li>:float</li>
<li>:integer</li>
<li>:primary_key</li>
<li>:string</li>
<li>:text</li>
<li>:time</li>
<li>:timestamp</li>
</ul>
<p>###rails migration###</p>
<p>Migration 是继承 ActiveRecord::Migration 的一个子类，它实现了两个方法： up (执行需要的改变)和 down (恢复所做的改变)<br>Active Record 提供以下独立于数据库的方法，用来执行普通数据定义任务的方法:</p>
<ul>
<li>add_colmn</li>
<li>add_index</li>
<li>change_column</li>
<li>change_table</li>
<li>create_table</li>
<li>create_join_table</li>
<li>drop_table</li>
<li>remove_column</li>
<li>remove_index</li>
<li>rename_column</li>
</ul>
<figure class="highlight ruby"><figcaption><span>ruby 创建一个migration</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails generate migration MIGRATION_NAME</span><br></pre></td></tr></table></figure>
<p>使用up/down方法<br>Migration里面的down方法能复原up方法所造成的变更。也就是说如果执行了up然后 再执行down，那么数据库的schema应该会没有改变。所以说，如果用up建立一个数据表， 就应该在down方法中删除它。明智的做法会使用跟up完全相反的顺便来做这些事情。</p>
<p>回滚（Rolling Back）<br>另一个常见的任务是回滚最后一个版本。比如你不小心打错了要修正。输入回滚命令时可以 不用输入先前版本的版本号，直接这样就行了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rake db:rollback</span><br></pre></td></tr></table></figure>
<p>这样会执行最后一个migration的down方法。如果要恢复多个migrations的话，可以多给 一个STEP参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rake db:rollback STEP=3</span><br></pre></td></tr></table></figure>
<p>这样会执行最后3个migrations的down方法。</p>
<p>要回滚然后重新执行最后一个migration的话可以直接执行db:migrate:redo。如果要回滚 重新执行的不止一个版本时可以用STEP参数，就跟db:rollback的用法一样：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rake db:migrate:redo STEP=3</span><br></pre></td></tr></table></figure>
<p>这两个rake任务只是用起来比较方便，让你可以不用输入一大串版本号数字。除了输入比较 方便外没有比db:migrate多做什么额外的工作。</p>
<p>4.2 重置数据库<br>最后是db:reset任务，它会删除数据库，然后重新建立数据库并在重新建立的数据库中 载入当前的schema。</p>
<p>所谓的载入schema跟执行全部的migrations是不一样的，请参照： schema.rb 。</p>
<p>4.3 执行指定的migration<br>如果你需要执行一个指定的migration的up或down方法，那么你可以用db:migrate:up和 db:migrate:down这两个任务。你只需指定版本号，就可以触发它的up或down方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rake db:migrate:up VERSION=20080906120000</span><br></pre></td></tr></table></figure></p>
<p>以上会执行20080906120000这个版本的migration的up方法。它会去确认这个migration之前有 没有跑过，所以，如果Active Record认为20080906120000已经跑过，那么执行 db:migrate:up VERSION=20080906120000将不会做任何操作。</p>
<p>###rails 删除控制器###<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails destroy</span><br></pre></td></tr></table></figure></p>
</section><nav id="post-nav"><span class="prev"><a href="/2013/06/18/2013-06-18-tdd-spec-helper/"><span class="arrow">←</span>Newer Posts</a></span><span class="next"><a href="/2013/06/14/2013-06-14-vim-split/">Older Posts<span class="arrow">→</span></a></span></nav></article></section><footer id="footer"><div id="social"><a class="symbol" href="https://github.com/fuzhouxxdong"><i class="fa fa-github"></i></a></div><p class="small">© Copyright 2018 &nbsp;<i class="fa fa-heart" aria-hidden="true">&nbsp;Dxx</i></p><p class="small">Powered by &nbsp;<a href="https://hexo.io/">Hexo &nbsp;</a>Theme By &nbsp;<a href="https://github.com/fuzhouxxdong/hexo-theme-dxx">Dxx</a></p></footer><script>hljs.initHighlightingOnLoad();</script></body></html>